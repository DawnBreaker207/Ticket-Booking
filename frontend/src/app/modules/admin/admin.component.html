<nz-layout class="h-screen w-full overflow-hidden">
  <!-- SIDER -->
  <nz-sider
    nzCollapsible
    [(nzCollapsed)]="isCollapsed"
    [nzTrigger]="null"
    nzWidth="256px"
    nzBreakpoint="lg"
    [nzCollapsedWidth]="0"
    nzTheme="light"
    class="shadow-md z-20 h-full border-r border-gray-100 hidden md:block overflow-y-auto"
  >
    <div
      class="h-16 flex items-center justify-center border-b border-gray-100 sticky top-0 bg-white z-10"
    >
      <a routerLink="/" class="flex items-center gap-2 text-decoration-none">
        <nz-icon nzType="shop" nzTheme="fill" class="text-3xl text-primary" />
        @if (!isCollapsed) {
          <h1
            class="text-xl font-bold tracking-wide text-gray-800 m-0 animate-fade-in"
          >
            CINE <span class="text-primary">ADMIN</span>
          </h1>
        }
      </a>
    </div>

    <ul
      class="border-r-0 py-4"
      nz-menu
      nzTheme="light"
      nzMode="inline"
      [nzInlineCollapsed]="isCollapsed"
    >
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/dashboard']">
        <nz-icon nzType="dashboard" nzTheme="outline" />
        <span>Thống Kê</span>
      </li>
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/movie']">
        <nz-icon nzType="video-camera" nzTheme="outline" />
        <span>Phim</span>
      </li>
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/theater']">
        <nz-icon nzType="shop" nzTheme="outline" />
        <span>Rạp Chiếu</span>
      </li>
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/showtime']">
        <nz-icon nzType="calendar" nzTheme="outline" />
        <span>Suất Chiếu</span>
      </li>
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/reservation']">
        <nz-icon nzType="ordered-list" nzTheme="outline" />
        <span>Vé đã đặt</span>
      </li>
      <li nz-menu-item nzMatchRouterExact [routerLink]="['/admin/user']">
        <nz-icon nzType="user" nzTheme="outline" />
        <span>Người dùng</span>
      </li>
    </ul>
  </nz-sider>
  <!--LAYOUT RIGHT-->
  <nz-layout class="h-full flex flex-col">
    <!--  HEADER  -->

    <nz-header
      class="!bg-white !p-0 border-b border-gray-200 shadow-sm sticky top-0 z-50"
    >
      <div class="h-16 flex items-center justify-between px-4 sm:px-6 gap-4">
        <!-- LEFT SIDE: Trigger + Breadcrumb -->
        <div class="flex items-center gap-4 flex-1">
          <!-- 1. Trigger Buttons (Kết nối logic isCollapsed) -->
          <div
            class="text-xl cursor-pointer text-gray-500 hover:text-primary transition-colors flex items-center"
            (click)="toggleCollapse()"
          >
            <!-- Bạn cần hàm này ở component cha -->
            <nz-icon [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'" />
          </div>

          <!-- 2. Breadcrumb (Rất quan trọng cho Admin) -->
          <div class="hidden md:block">
            <nz-breadcrumb [nzSeparator]="iconTemplate">
              <ng-template #iconTemplate>
                <nz-icon nzType="right" class="text-xs text-gray-400" />
              </ng-template>
              <nz-breadcrumb-item>Admin</nz-breadcrumb-item>
              @for (crum of breadcrumbs; track crum.url; let last = $last) {
                <nz-breadcrumb-item>
                  @if (last) {
                    <span class="font-semibold text-gray-800">{{
                      crum.label
                    }}</span>
                  } @else {
                    <a
                      [routerLink]="crum.url"
                      class="text-gray-500 hover:text-primary transition-colors"
                      >{{ crum.label }}</a
                    >
                  }
                </nz-breadcrumb-item>
              }
            </nz-breadcrumb>
          </div>
        </div>

        <!-- RIGHT SIDE: Search - Notify - Profile -->
        <div class="flex items-center gap-3 sm:gap-6">
          <!-- 3. Search Bar (Responsive) -->

          <!-- SEARCH BAR FIXED -->
          <div class="hidden md:flex items-center w-64 h-10 group">
            <div
              class="flex items-center w-full h-full bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-full px-4 transition-all group-focus-within:bg-white group-focus-within:border-primary group-focus-within:ring-2 group-focus-within:ring-primary/20"
            >
              <nz-icon
                nzType="search"
                class="text-gray-400 group-focus-within:text-primary transition-colors text-lg shrink-0"
              />
              <input
                type="text"
                placeholder="Tìm kiếm..."
                class="w-full h-full bg-transparent border-none outline-none text-sm ml-2 text-gray-700 placeholder-gray-400 p-0"
              />
            </div>
          </div>

          <!-- 4. Notification Bell with Badge -->
          <div
            class="relative cursor-pointer text-gray-500 hover:text-primary transition-colors"
            nz-dropdown
            [nzDropdownMenu]="notifyMenu"
            nzTrigger="click"
            nzPlacement="bottomRight"
          >
            <nz-badge
              [nzCount]="5"
              [nzStyle]="{ backgroundColor: '#3b82f6' }"
              nzSize="small"
            >
              <nz-icon nzType="bell" class="text-xl" />
            </nz-badge>
          </div>

          <!-- Menu thông báo dropdown (Ví dụ) -->
          <nz-dropdown-menu #notifyMenu="nzDropdownMenu">
            <div
              class="bg-white w-80 rounded-xl shadow-xl border border-gray-100 py-2 mt-2"
            >
              <div
                class="px-4 py-2 border-b border-gray-100 font-bold text-gray-700 flex justify-between"
              >
                <span>Thông báo</span>
                <span class="text-xs text-primary cursor-pointer"
                  >Đánh dấu đã đọc</span
                >
              </div>
              <ul class="max-h-64 overflow-y-auto">
                <li
                  class="px-4 py-3 hover:bg-gray-50 cursor-pointer flex gap-3 items-start border-b border-gray-50"
                >
                  <div
                    class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center shrink-0"
                  >
                    <nz-icon nzType="pay-circle" />
                  </div>
                  <div>
                    <p class="text-sm text-gray-800 font-medium">
                      Đơn hàng mới #1234
                    </p>
                    <p class="text-xs text-gray-500 mt-1">Vừa xong</p>
                  </div>
                </li>
                <!-- Thêm item mẫu khác -->
              </ul>
            </div>
          </nz-dropdown-menu>

          <!-- Divider -->
          <div class="h-8 w-px bg-gray-200 hidden sm:block"></div>

          <!-- 5. Component Profile của bạn -->
          <app-profile-menu />
        </div>
      </div>
    </nz-header>

    <nz-content class="flex-1 overflow-y-auto bg-slate-50">
      <div class="min-h-full">
        <router-outlet />
      </div>

      <nz-footer class="text-center text-gray-400 bg-transparent mt-8">
        Booking Ticket System {{ date.getFullYear() }}
      </nz-footer>
    </nz-content>
  </nz-layout>
</nz-layout>
