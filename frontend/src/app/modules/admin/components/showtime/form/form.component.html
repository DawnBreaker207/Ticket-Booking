<form nz-form [formGroup]="form" class="w-full h-full">
  <nz-row [nzGutter]="16">
    <!--  Poster-->
    <nz-col [nzSpan]="8">
      <form formGroupName="moviePosterUrl">
        <div class="flex flex-col gap-3">
          <div
            class="w-full bg-[#f5f5f5] border-1 rounded-lg overflow-hidden"
            [style.aspect-ratio]="'2/3'"
          >
            <img
              [src]="
                form.get('moviePosterUrl')?.value ||
                'https://via.placeholder.com/150x200'
              "
              class="w-full h-full object-cover block"
              alt=""
            />
          </div>
        </div>

      </form>
    </nz-col>

    <nz-col [nzSpan]="16">
      <div class="flex flex-col h-full justify-between pt-5">
        <div class="relative">
          <nz-form-item>
            <nz-input-group nzAddOnBeforeIcon="search">
              <input
                nz-input
                placeholder="Tìm kiếm"
                style="width: 500px"
                type="text"
                [formControl]="searchCtrl"
              />
            </nz-input-group>
          </nz-form-item>
          <ng-container *ngTemplateOutlet="searchDropdown">
          </ng-container>

        </div>


        <nz-form-item>
          <nz-form-label nzRequired>Show date</nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Show date'">
            <nz-date-picker
              nzSize="default"
              class="w-full"
              nzFormat="yyyy-MM-dd"
              formControlName="showDate"
              [nzDisabled]="mode === 'view'"
            ></nz-date-picker>
          </nz-form-control>
        </nz-form-item>


        <nz-form-item>
          <nz-form-label nzRequired>Show time</nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Show time '">
            <nz-time-picker nzSize="default"
                            class="w-full"
                            nzFormat="HH:mm"
                            formControlName="showTime"
                            [nzDisabled]="mode === 'view'">
            </nz-time-picker>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Theater</nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Enter theater'">
            <nz-select formControlName="theaterId"
                       [nzDisabled]="mode === 'view'"
                       nzPlaceHolder="'Select Theater'">
              @for (theater of theaters$ | async; track theater.id) {
                <nz-option [nzLabel]="theater.name" [nzValue]="theater.id"></nz-option>
              }
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Price</nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Enter price'">
            <nz-select formControlName="price"
                       [nzDisabled]="mode === 'view'"
                       nzPlaceHolder="'Select Price'">
              <nz-option [nzLabel]="50000" [nzValue]="50000"></nz-option>
              <nz-option [nzLabel]="100000" [nzValue]="100000"></nz-option>
              <nz-option [nzLabel]="150000" [nzValue]="150000"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Seat</nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Enter seat'">
            <nz-select formControlName="totalSeats"
                       [nzDisabled]="mode === 'view'"
                       nzPlaceHolder="'Select Seat'">
              <nz-option [nzLabel]="40" [nzValue]="40"></nz-option>
              <nz-option [nzLabel]="50" [nzValue]="50"></nz-option>
              <nz-option [nzLabel]="60" [nzValue]="60"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </nz-col>
  </nz-row>
</form>

<ng-template #searchDropdown>
  @if (searchResults() && searchResults().length > 0) {
    <div
      class="absolute z-50 top-full mt-1 w-full bg-white border rounded shadow max-h-72 overflow-y-auto"
    >
      <nz-list
        [nzDataSource]="searchResults()"
        [nzRenderItem]="item"
        [nzBordered]="true"
        class="max-h-52 overflow-y-auto"
      >
        <ng-template #item let-movie>
          <nz-list-item
            (click)="selectMovie(movie)"
            class="cursor-pointer transition p-2 rounded"
            [ngClass]="{
                      'bg-blue-100': selectedMovie()?.id === movie.id,
                      'hover:bg-gray-100': selectedMovie()?.id !== movie.id,
                    }"
          >
            <nz-list-item-meta
              [nzAvatar]="nzAvatar"
              [nzTitle]="nzTitle"
              [nzDescription]="nzDescription"
            >
            </nz-list-item-meta>

            <ng-template #nzAvatar>
              <nz-avatar
                nzShape="square"
                [nzSize]="64"
                [nzSrc]="movie.poster"
              >
              </nz-avatar>
            </ng-template>

            <ng-template #nzTitle>
              <span class="font-semibold">{{ movie.title }}</span>
            </ng-template>

            <ng-template #nzDescription>
                      <span class="text-xs text-gray-500">
                        {{ movie.release_date | date: "yyyy" }} —
                        {{ movie.overview }}
                      </span>
            </ng-template>
          </nz-list-item>
        </ng-template>
      </nz-list>
    </div>
  }
</ng-template>
