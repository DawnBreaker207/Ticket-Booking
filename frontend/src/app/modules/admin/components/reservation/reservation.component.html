<div class="min-h-screen bg-slate-50 py-10 px-4 sm:px-6 lg:px-8">
  <div
    class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8"
  >
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Quản lý đơn đặt</h1>
    </div>
  </div>
  <form
    [formGroup]="form"
    (submit)="onSubmit()"
    class="mb-5 flex items-center justify-between gap-3"
  >
    <nz-input-group nzAddOnBeforeIcon="search" class="!w-fit">
      <input
        formControlName="query"
        nz-input
        placeholder="Tìm kiếm"
        type="text"
        class="!w-[500px]"
      />
    </nz-input-group>

    <nz-select
      formControlName="reservationStatus"
      class="w-[150px]"
      nzPlaceHolder="Trạng thái"
    >
      @for (s of reservationStatus; track s) {
        <nz-option [nzLabel]="s" [nzValue]="s"></nz-option>
      }
    </nz-select>

    <nz-select class="w-[150px]" nzPlaceHolder="Phương thức thanh toán">
      @for (p of paymentMethod; track p) {
        <nz-option [nzLabel]="p" [nzValue]="p"></nz-option>
      }
    </nz-select>

    <nz-select class="w-[150px]" nzPlaceHolder="Trạng thái thanh toán">
      @for (s of paymentStatus; track s) {
        <nz-option [nzLabel]="s" [nzValue]="s"></nz-option>
      }
    </nz-select>

    <nz-range-picker formControlName="dateRange"></nz-range-picker>

    <nz-input-group nzAddOnBeforeIcon="dollar" class="!w-fit">
      <input
        formControlName="totalAmount"
        nz-input
        placeholder="Giá"
        type="number"
        class="!w-[100px]"
      />
    </nz-input-group>

    <nz-select
      formControlName="sortBy"
      class="w-[150px]"
      nzPlaceHolder="Sắp xếp"
    >
      <nz-option nzLabel="Mới nhất" nzValue="newest"></nz-option>
      <nz-option nzLabel="Cũ nhất" nzValue="oldest"></nz-option>
    </nz-select>

    <button nz-button nzType="primary" type="submit">Apply</button>
    <button nz-button nzType="primary" (click)="clearFilter()">Clear</button>
    <button nz-dropdown nz-icon [nzDropdownMenu]="select" nzType="export">
      Export
    </button>
    <nz-dropdown-menu #select="nzDropdownMenu">
      <ul nz-menu>
        <li nz-menu-item (click)="exportReport('pdf')">PDF</li>
        <li nz-menu-item (click)="exportReport('html')">HTML</li>
        <li nz-menu-item (click)="exportReport('excel')">Excel</li>
      </ul>
    </nz-dropdown-menu>
  </form>

  <nz-spin [nzSpinning]="loading$ | async">
    @if (reservation$ | async; as reservations) {
      <div
        class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 overflow-hidden"
      >
        <nz-table
          [nzData]="reservations"
          nzShowPagination
          [nzFrontPagination]="false"
          [nzTotal]="(pagination$ | async)?.totalElements || 0"
          [nzPageIndex]="pageIndex"
          [nzPageSize]="pageSize"
          [nzShowSizeChanger]="true"
          (nzPageIndexChange)="onPageChange($event)"
          (nzPageSizeChange)="onSizeChange($event)"
        >
          <thead>
            <tr>
              @for (item of headerColumn; track item) {
                <th>
                  {{ item }}
                </th>
              }
            </tr>
          </thead>
          <tbody>
            @for (item of reservations; track item.id) {
              <tr
                class="group hover:bg-gray-50 transition-colors border-b border-gray-100"
              >
                <td>{{ item.id }}</td>
                <td>
                  <nz-tag [nzColor]="(item.reservationStatus | tags).color">
                    {{ (item.reservationStatus | tags).status }}
                  </nz-tag>
                </td>
                <td>{{ item.totalAmount | currency: "VND" }}</td>
                <td>{{ item.createdAt | date: "dd/MM/yyyy" }}</td>
                <td>
                  <div>
                    <nz-space>
                      <button
                        nz-button
                        nzType="text"
                        nzShape="circle"
                        (click)="openModal(item.id)"
                      >
                        <nz-icon nzType="eye" nzTheme="twotone"></nz-icon>
                      </button>
                      <!--              <button nz-button nzType="text" nzShape="circle">-->
                      <!--                <nz-icon nzType="edit" nzTheme="twotone" nzTwotoneColor="#52c41a"></nz-icon>-->
                      <!--              </button>-->
                      <button nz-button nzType="text" nzShape="circle">
                        <nz-icon
                          nzType="delete"
                          nzTheme="twotone"
                          nzTwotoneColor="#e7000b"
                        />
                      </button>
                    </nz-space>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </nz-table>
      </div>
    }
  </nz-spin>
  @let error = error$ | async;
  @if (error) {
    <nz-alert nzType="error" [nzMessage]="error" nzShowIcon nzCloseable>
    </nz-alert>
  }
</div>
